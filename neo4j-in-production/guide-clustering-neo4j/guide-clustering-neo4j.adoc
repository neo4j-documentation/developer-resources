= guide-clustering-neo4j
:level: Beginner
:toc:
:toc-placement!:
:toc-title: Overview
:toclevels: 1

.Goals
[abstract]
We live in a connected world. There are no isolated pieces of information, but rich, connected domains all around us.

.Prerequisites
[abstract]
Nodes can be tagged with zero to many labels representing their different roles in the domain. In addition to contextualizing node and relationship properties, labels may also serve to attach metadata—​index or constraint information, for example—​to nodes. {level}

toc::[]

== Section 1

text and pictures for section 1

=== Data Synchronization between master and slaves

Neo4j HA is a full master-slave replication. Any index created on the master is propagated to the slaves depending on the settings of ha.tx_push_factor and ha.pull_interval. See http://docs.neo4j.org/chunked/stable/ha.html for details.

=== Mending Procedure for Master

Mending procedure for master

* Shut down all members of the cluster and stop any load against the cluster
* On the master instance, copy the data/graph.db folder as a backup
* Modify neo4j-server.properties, set the org.neo4j.server.database.mode to "STANDALONE"
* Start the database and, once it's running, stop it again (this is to ensure he database is cleanly shut down)
* Remove all files named nioneo_logical.log.vXX in data/graph.db, being careful to not remove any files without the "v", like nioneo_logical.log.1 or nioneo_logical.log.active
* Start the server and use either neo4j-shell or the neo4j browser to issue the following two queries:

. First query, note the id returned here

.. CREATE (n) RETURN id(n)

. Second query, use the id returned from the previous one

.. START n=node( <ID RETURNED> ) DELETE n // For instance, START n=node(1234) DELETE n

* Stop the server
* Set org.neo4j.server.database.mode to HA
* Start the server

=== Mending Procedure for Slaves
* On each slave, remove the data/graph.db folder
* Start the slave, watch data/graph.db for it to copy the store from the master
* Once copying is done, move to do the same thing on the second slave

=== Configuring a two slave cluster with an arbiter

There's a step-by-step tutorial for setting up HA available here: http://docs.neo4j.org/chunked/stable/ha-setup-tutorial.html. For a 2 node cluster, you'll actually want to run 3 separate machines, and use the Neo4j arbiter on the 3rd. Details on the arbiter are available in the documentation here: http://docs.neo4j.org/chunked/stable/arbiter-instances.html. The configuration for the arbiter is identical to that of a regular instance, excepting anything relating to the actual graph db itself (since an arbiter doesn't hold any data).

The ha.initial_hosts should be the same on all the instances, including the arbiter. The arbiter should have a unique ha.server_id (3 is fine).

=== Setting a server in slave-only mode

See ha.slave_only here: http://docs.neo4j.org/chunked/stable/ha-configuration.html

You might want to configure a machine with that setting if it’s acting as a reporting instance but you need to make sure that 2 members don’t have that setting otherwise you won’t have any failover in the cluster.

image::neo4j-logo.png[]

text and pictures for subsection 1.1

[role=sidebar]
=== Sidebar

* links to manual
* link to blog
* link to call to action


== Section 2

text and pictures for section 2

=== Subsection

image::neo4j-logo.png[]

[role=sidebar]
=== Further Reading

* links to manual
* link to blog
* link to call to action
****

// .. etc ..
