<!doctype html> <!--[if IE 9]>
<html class="no-js ie9" lang="en">
   <![endif]-->
   <html class="no-js" lang="en">
      <head>
         <meta charset="utf-8"/>
         <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
         <link rel="shortcut icon" href="http://neo4j.com/wp-content/themes/neo4jzurb/favicon.ico"/>
         <title>From SQL to Cypher - A hands-on Guide | Developer Resources | Neo4j Graph Database</title>
         <script type="text/javascript">
            var _kmq = _kmq || [];
            var _kmk = _kmk || 'a6a57b4b368caf34f5a6f2042eb075f9e559d779';
            function _kms(u){
                setTimeout(function(){
                    var d = document, f = d.getElementsByTagName('script')[0],
                        s = d.createElement('script');
                    s.type = 'text/javascript'; s.async = true; s.src = u;
                    f.parentNode.insertBefore(s, f);
                }, 1);
            }
            _kms('//i.kissmetrics.com/i.js');
            _kms('//doug1izaerwt3.cloudfront.net/' + _kmk + '.1.js');
         </script> <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            //Allow Linker
            ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
            ga('send', 'pageview');

            // Load the plugin.
            ga('require', 'linker');

            // Define which domains to autoLink.
            ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
         </script>
         <link rel="canonical" href="http://neo4j.com/guides/basic-data-modeling/"/>
         <meta property="og:locale" content="en_US"/>
         <meta property="og:type" content="article"/>
         <meta property="og:title" content="Basic Data Modeling - Neo4j Graph Database"/>
         <meta property="og:description" content="Please refer to the Neo4j Manual"/>
         <meta property="og:url" content="http://neo4j.com/guides/basic-data-modeling/"/>
         <meta property="og:site_name" content="Neo4j Graph Database"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Feed" href="http://neo4j.com/feed/"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Comments Feed" href="http://neo4j.com/comments/feed/"/>
         <link rel="alternate" type="application/rss+xml" title="Neo4j Graph Database &raquo; Basic Data Modeling Comments Feed" href="http://neo4j.com/guides/basic-data-modeling/feed/"/>
         <link rel='stylesheet' id='font-awesome-four-css' href="http://neo4j.com/wp-content/plugins/font-awesome-4-menus/css/font-awesome.min.css?ver=4.1.0" type='text/css' media='all'/>
         <link rel='stylesheet' id='foundation-css' href="http://neo4j.com/wp-content/themes/neo4jzurb/assets/css/app.css?ver=4.0.0" type='text/css' media='screen'/>
         <link rel='stylesheet' id='neo-codemirror-css' href="http://neo4j.com/wp-content/themes/neo4jzurb/assets/css/codemirror-neo.css?ver=4.0.0" type='text/css' media='screen'/>
         <script type='text/javascript'>
            /* <![CDATA[ */
            var ajax_object = {"ajaxurl":"http:\/\/neo4j.com\/wp-admin\/admin-ajax.php"};
            /* ]]> */
         </script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/neo4j-download/js/download.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/jquery-updater/js/jquery-2.1.0.min.js?ver=2.1.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/vendor/modernizr.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/foundation.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/vendor/codemirror.min.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_codemirror.js?ver=4.0.0'></script> <script type='text/javascript' src='//use.typekit.net/rdt4xku.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/misc.js?ver=4.0.0'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_calculator_v3.js?ver=4.0.0'></script>
         <link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://neo4j.com/xmlrpc.php?rsd"/>
         <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://neo4j.com/wp-includes/wlwmanifest.xml"/>
         <meta name="generator" content="WordPress 3.9.2"/>
         <link rel='shortlink' href="http://neo4j.com/?p=32079"/>
         <style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
      </head>
      <body>
         <div class="off-canvas-wrap">
            <div class="inner-wrap">
               <aside class="left-off-canvas-menu">
                  <ul class="off-canvas-list">
                     <li><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                     <li><a href="http://neo4j.com/customers/">Customers</a></li>
                     <li><a href="http://neo4j.com/community/">Community</a></li>
                     <li><a href="http://neo4j.com/docs/">Docs</a></li>
                     <li>
                        <div class="medium-3 columns headspace-20">
                           <div class="row collapse">
                              <div class="small-10 columns">
                                 <form role="search" method="get" id="searchform" class="searchform" action="http://neo4j.com/">
                                    <input type="text" name="s" id="s"/>
                              </div>
                              <div class="small-2 columns"> <div class="button postfix"> <input type="image" id="searchsubmit" src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/searchicon.png" style="vertical-align:middle;"/> </form> </div> </div>
                           </div>
                        </div>
                     </li>
                  </ul>
               </aside>
               <div class="marquee">
                  <div class="navigation">
                     <div class="navigation-large hide-for-small">
                        <div class="row">
                           <div class="medium-9 large-7 columns nav-list">
                              <ul class="inline-list">
                                 <li><a href="http://neo4j.com/index.php"><img src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/logo-neo4j.svg" class="logo" alt="neo4j"></a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/customers/">Customers</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/community/">Community</a></li>
                                 <li class="nav-link"><a href="http://neo4j.com/docs/">Docs</a></li>
                              </ul>
                           </div>
                           <div class="medium-3 large-3 columns nav-search">
                              <div class="row collapse">
                                 <div class="small-10 columns">
                                    <form role="search" method="get" id="searchform" class="searchform" action="http://neo4j.com/">
                                       <input type="text" name="s" id="s"/>
                                 </div>
                                 <div class="small-2 columns"> <div class="button postfix"> <input type="image" id="searchsubmit" src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/searchicon.png" style="vertical-align:middle;"/> </form> </div> </div>
                              </div>
                           </div>
                           <div class="large-2 columns show-for-large-up"> <a href="http://neo4j.com/download/" class="tiny small button right">Download</a> </div>
                        </div>
                     </div>
                     <nav class="tab-bar show-for-small">
                        <section class="left-small"> <a class="left-off-canvas-toggle menu-icon"><span></span></a> </section>
                        <section class="middle tab-bar-section"> <img src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/logo-neo4j.svg" class="logo" alt="neo4j" </section>
                     </nav>
                  </div>
                  <div class="row text-center">
                     <div class="medium-10 small-centered columns">
                        <h1 class="hero-title">Developer Resources</h1>
                        <h2 class="subheader"></h2>
                     </div>
                  </div>
               </div>
               <article id="content" role="main">
                  <style>
                    .side-nav li a:not(.button) { 
                       display:inline;
	                 }
                    .row { max-width: 62.5rem !important; }
                     .lead
                     {
                     display: none;
                     }
                     section.row
                     {
                     padding: 0;
                     }
                     #content section.row
                     {
                     padding-left: .5em;
                     padding-right: .5em;
                     }
                     .row
                     {
                     }
                     #content section.row .accordion-navigation > a {
                     background: none repeat scroll 0 0 rgba(0, 0, 0, 0) !important;
                     padding: 0 !important;
                     }
                     .accordion .content { padding: 0; }
                     .row .row { margin: auto; }
                     .columns.medium-12
                     {
                     padding-left: 0;
                     }
                  </style>
                  <style> .lead { display: none; } section.row { padding: 0; } #content section.row { max-width: 62.5rem; padding-left: .5em; padding-right: .5em; } .row { max-width: 80em; } #content section.row .accordion-navigation > a { padding: 0 !important; } .accordion .content { padding: 0; } .row .row { margin: auto; } .columns.medium-12 { padding-left: 0; } .fa-stack.fa-lg { color: #0f5788; display: block; float: left; height: 70px; margin-right: 1em; padding-right: 2em; width: 50px; } h3 { font-weight: normal; } strong, b { font-weight:600; font-color:#333; } .calloutsection { padding: 20px 0; } section { padding: 40px 0 0 0; } .marquee { height: auto; margin-top: 1em; } #main-content .entry-title { display: none; } #main-content .subheader { display: none; } .marquee h1, .marquee h2 { padding-top: 0; } #main-content .next-steps h5 { font-size: 12px; } #main-content .next-steps h3 { margin-bottom: 1em; } #main-content .content.active { display: block; } #main-content .content { display: none; } #main-content { padding-top: 0; } .use-case .tab-container .content.active { border-top: 1px solid rgba(15, 87, 136, 0.7); padding: 2em 1em 1em; } .tabs dd > a:hover { color: #3d5360; } .breadcrumbs > * a, .breadcrumbs > * span { color: #0f5788; text-transform: none; } .breadcrumbs > * { text-transform: none; } .top-bar { height: 80px; } #main-content .top-bar-section ul { margin-top: 1em; } .panel-pod p { font-size: 14px; font-weight: normal; line-height: 26px; } .panel-pod > a { display: block; margin-bottom: 1em; } .panel-pod p a { display: block; margin-top: 1em; } .panel-pod { text-align: left; } .tab-container { margin-bottom: 2em; } .panel-pod img { display: block; margin: auto; } #content h3 { font-weight: 100; } #content ul {}
                  #content section.row .accordion-navigation > a {
                      background: url("http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/collapse.png") no-repeat scroll 100% 50% transparent;
                      border-bottom: 1px dashed #ddd;
                      padding: 0 !important;
                  }
                  .accordion-navigation.active > a {
                      background: url("http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/roll-up.png") no-repeat scroll 100% 50% transparent !important;
                  }

                  .accordion-navigation h5 {
                      font-weight: 100;
                      height: 2em;
                      line-height: 2em;
                      margin: 0;
                  }

                  .content ul {
                  margin-top: 1em;
                  }

                  .breadcrumbs>*:before {
                     content: "â†’";
                     color: #aaa;
                     margin: 0 0.75rem;
                     position: relative;
                     top: 0;
                     }

                  #content code
                  {
                   font-weight: 100;
                  }

                  #content h3
                  {
                   margin-bottom: .5em;
                  }

                  #content h5
                  {
                   font-weight: 100;
                  }

                  #content h4
                  {
                   font-weight: 400;
                  }

                  #content strong
                  {
                   font-weight: 400;
                  }

                  #content h4
                  {
                   margin-bottom: 1em;
                  }

                  #content .title {
                      font-size: 20px;
                  }

                  #content .breadcrumbs { margin-bottom: 0; }
                  </style>
                  <div style="padding-left: 1em; padding-right: 1em;">
                     <div class="row" style="padding: 10px;">
                        <div class="columns large-12" style="padding:10px 0 0;">
                           <ul class="breadcrumbs">
                              <li><a href="/developer-resources">Developer Guides</a></li>
                              <li><a href="../">Cypher Query Language</a></li>
                              <li class="current"><a href="#">From SQL to Cypher - A hands-on Guide</a></li>
                           </ul>
                        </div>
                     </div>
                     <!-- <div class="row">
                        <div class="columns large-12">
                           <h1 style="font-size:2.1rem;">From SQL to Cypher - A hands-on Guide</h1>
                        </div>
                     </div> -->
                     <section class="row" style="padding:10px 0;">
                        <div class="large-12 columns" style="padding-top:0;">
                           <div id="content">
                              <div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<div class="title">Goals</div>
<blockquote style="padding-left: 0;">
This guide teaches anyone familiar with SQL how to write the equivalent, efficient Cypher statements. We&#8217;ll use the well-known Northwind database to explain the concepts and work through the queries from simple to advanced.
</blockquote>
</div>
<div class="quoteblock abstract">
<div class="title">Prerequisites</div>
<blockquote style="padding-left: 0;">
You should have a basic understanding of the <a href="/developer/graph-database#property-graph">property graph model</a>. Having <a href="/download">downloaded</a> and installed the Neo4j server helps you code along with the examples. Importing the data is covered in our <a href="/developer/working-with-data/guide-importing-data-and-etl">data import guide</a>.
</blockquote>
</div>


<div class="label">Beginner</div>
<hr/>

<div class="toc">
<h3 class="title">Overview</h3>

<ul class="sectlevel2">
<li><a href="#_a_few_words_about_cypher">A few words about Cypher</a></li>
<li><a href="#_data_model_comparison">Data Model Comparison</a></li>
<li><a href="#_data_import">Data Import</a></li>
<li><a href="#_cypher_is_all_about_patterns">Cypher is all about Patterns</a></li>
<li><a href="#_northwind_example_model">Northwind Example Model</a></li>
<li><a href="#_graph_model">Graph Model</a></li>
<li><a href="#_querying_the_data_step_by_step">Querying the Data Step by Step</a></li>
<li><a href="#_aggregation_top_sellers">Aggregation, Top-Sellers</a></li>
<li><a href="#_collecting_master_detail_queries">Collecting Master-Detail Queries</a></li>
<li><a href="#_hierarchies_and_trees_variable_length_paths">Hierarchies and Trees - Variable Length Paths</a></li>
<li><a href="#_create_a_new_product">Create a new product</a></li>
<li><a href="#_create_an_order">create an order</a></li>
</ul>

<hr>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_a_few_words_about_cypher">A few words about Cypher</h4>



<div class="paragraph">
<p>Cypher is like SQL a declarative, textual query language.</p>
</div>



<div class="paragraph">
<p>It consists of <a href="/docs/stable/query-general.html">clauses</a>, keywords and <a href="docs/stable/cypher-expressions.html">expressions</a> like predicates and functions, many of which will be familiar (like <code>WHERE</code>, <code>ORDER BY</code>, <code>SKIP LIMIT</code>, <code>AND</code>, <code>p.UnitPrice &gt; 10</code>).</p>
</div>



<div class="paragraph">
<p>As Cypher is all about expressing patterns, we added a special clause <a href="/docs/stable/query-match.html"><code>MATCH</code></a> for matching those patterns in your graph.
These patterns are what you would usually draw on a whiteboard just converted into text using ASCII-art symbols.</p>
</div>



<div class="paragraph">
<p>We represent the circles of nodes with round parentheses, like this: <code>(p:Product)</code>.</p>
</div>



<div class="paragraph">
<p>And the arrows of relationships are drawn as such <code>-&#8594;</code>, you can add the relationship-type and other information in square brackets <code>-[:ORDERED]&#8594;</code>.</p>
</div>



<div class="paragraph">
<p>Bringing both together gives us a first hint at the expressiveness of graph patterns: <code>(cust:Customer)-[:ISSUED]&#8594;(o:Order)-[:CONTAINS]&#8594;(prod:Product)</code>.</p>
</div>



<div class="paragraph">
<p>There is more to these patterns, you&#8217;ll see that in an instant.</p>
</div>



<div class="paragraph">
<p>Other highlights of Cypher are graph concepts like paths, variable length paths, shortest-path functions;
the support of many collection functions, operations and predicates and the ability to chain query parts.</p>
</div>



<div class="paragraph">
<p>You can use Cypher as well to update the graph structure and data and even ingest large amounts of CVS data.</p>
</div>



<div class="paragraph">
<p>The Cypher language documentation is available in the <a href="/docs/stable/cypher-query-lang.html">Neo4j manual</a> together with a complete <a href="/docs/stable/cypher-refcard/">Reference Card</a>.</p>
</div>

</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_data_model_comparison">Data Model Comparison</h4>



<div class="paragraph">
<p>A well normalized relational model, which was not yet denormalized for performance reasons can be translated into the equivalent graph model.
Graph model shapes are mostly driven by use-cases, so there will be opportunity for optimization and model evolution afterwards.</p>
</div>



<div class="paragraph">
<p>A good, normalized Entity-Relationship diagram often already represents a decent graph model.
So if you still have the orignal ER diagram available, try to use it as a guide.</p>
</div>



<div class="paragraph">
<p>Here are some tips that help you with the transformation:</p>
</div>

<div class="ulist">


<ul>
<li>
Each entity table is represented by a label on nodes
</li>
<li>
Each row in a table is a node
</li>
<li>
Columns on those tables become node properties.
</li>
<li>
Remove technical primary keys, keep business primary keys
</li>
<li>
Add unique constraints for business primary keys, add indexes for frequent lookup attributes
</li>
<li>
Replace foreign keys with relationships to the other table, remove them afterwards
</li>
<li>
Remove data with default values, no need to store those
</li>
<li>
Data in tables that is denormalized and duplicated might have to be pulled out into separate nodes to get a cleaner model.
</li>
<li>
Indexed column names, might indicate an array property (like email1, email2, email3)
</li>
<li>
JOIN tables are transformed into relationships, columns on those tables become relationship properties
</li>
</ul>

</div>


<div class="paragraph">
<p>It is important to have an understanding of the graph model before you start to import data, then it just becomes the task of hydrating that model.</p>
</div>

</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_data_import">Data Import</h4>



<div class="paragraph">
<p>Most relational databases allow an easy export of tables to CSV, which then can be imported by only uis</p>
</div>



<div class="paragraph">
<p>If you are a developer you can also just connect to the relational database using your regular driver, load the data from there with SQL and create the graph data</p>
</div>

</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_cypher_is_all_about_patterns">Cypher is all about Patterns</h4>



<div class="paragraph">
<p>3-4 sentences</p>
</div>

</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_northwind_example_model">Northwind Example Model</h4>

<div class="sect3 "  >
    
<h5 id="_relational_model">Relational model</h5>

<div class="imageblock">
<p class="content">
<img src="http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/Northwind_diagram.jpg" alt="Northwind diagram">
</p>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_graph_model">Graph Model</h4>

<div class="imageblock">
<p class="content">
<img src="http://dev.assets.neo4j.com.s3.amazonaws.com/wp-content/uploads/northwind_graph_simple.png" alt="northwind graph simple" width="800">
</p>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_querying_the_data_step_by_step">Querying the Data Step by Step</h4>

<div class="sect3 "  >
    
<h5 id="_find_all_products">Find all Products</h5>



<div class="paragraph">
<p>Easy in SQL just select everything from the <code>Product</code> table.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.*
FROM products as p;</code></pre>
</div>
</div>


<div class="paragraph">
<p>Similar in Cypher, you just match a simple pattern <em>all nodes with the label `:Product`</em>, and return them.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product)
RETURN p;</code></pre>
</div>
</div>


<div class="paragraph">
<p>More efficient is to return only a subset of attributes, like <code>ProductName</code> and <code>UnitPrice</code>.
And while we&#8217;re on it, let&#8217;s also order by price and only return the 10 most expensive items.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.ProductName, p.UnitPrice
FROM products as p
ORDER BY p.UnitPrice DESC
LIMIT 10;</code></pre>
</div>
</div>


<div class="paragraph">
<p>You can copy and paste the changes from SQL to Cypher, it&#8217;s thankfully unsurprising.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product)
RETURN p.productName, p.unitPrice
ORDER BY p.unitPrice DESC
LIMIT 10;</code></pre>
</div>
</div>
</div>
<div class="sect3 "  >
    
<h5 id="_find_single_product_by_name">Find single Product by Name</h5>



<div class="paragraph">
<p>If we only want to look at a single Product, for instance delicious <em>Chocolade</em>, we filter in SQL with a <code>WHERE</code> clause.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.ProductName, p.UnitPrice
FROM products as p
WHERE p.ProductName = 'Chocolade';</code></pre>
</div>
</div>


<div class="paragraph">
<p>Same in Cypher, here the <code>WHERE</code> belongs to the <code>MATCH</code> statement. Boring.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product)
WHERE p.productName = "Chocolade"
RETURN p.productName, p.unitPrice;</code></pre>
</div>
</div>


<div class="paragraph">
<p>There is a shortcut in Cypher if you match for a labeled node with a certain attribute.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product {productName:"Chocolade"})
RETURN p.productName, p.unitPrice;</code></pre>
</div>
</div>


<div class="paragraph">
<p>If you want to match quickly by this node-label and attribute combination, it makes sense to create an index for that pair, if you haven&#8217;t during the <a href="/developer/working-with-data/guide-importing-data-and-etl">import</a>.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>CREATE INDEX ON :Product(productName);</code></pre>
</div>
</div>
</div>
<div class="sect3 "  >
    
<h5 id="_filter_products">Filter Products</h5>



<div class="paragraph">
<p>Filtering can go further, let&#8217;s try to find some expensive things starting with "C".</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.ProductName, p.UnitPrice
FROM products as p
WHERE p.ProductName LIKE 'C%' AND p.UnitPrice &gt; 100;</code></pre>
</div>
</div>


<div class="paragraph">
<p>The <code>LIKE</code> operator is replaced by a regular expression, but <a href="http://neo4j.com/docs/stable/query-functions-mathematical.html">math operations</a> are widely supported in Cypher.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product)
WHERE p.productName =~ "C.*" AND p.unitPrice &gt; 100
RETURN p.productName, p.unitPrice;</code></pre>
</div>
</div>
</div>
<div class="sect3 "  >
    
<h5 id="_joining_products_with_customers">Joining Products with Customers</h5>



<div class="paragraph">
<p>We want to see who bought Chocolade.
Let&#8217;s join the four tables together, refer to the model (ER-diagram) when you&#8217;re unsure.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT distinct c.CompanyName
FROM customers AS c
JOIN orders AS o ON (c.CustomerID = o.CustomerID)
JOIN order_details AS od ON (o.OrderID = od.OrderID)
JOIN products as p ON (od.ProductID = p.ProductID)
WHERE p.ProductName = 'Chocolade';</code></pre>
</div>
</div>


<div class="paragraph">
<p>The graph model (have a look) is much simpler as we don&#8217;t need join tables, and expressing connections as graph patterns, is easier to read too.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product {productName:"Chocolade"})&lt;-[:PRODUCT]-(:Order)&lt;-[:PURCHASED]-(c:Customer)
RETURN distinct c.companyName;</code></pre>
</div>
</div>
</div>
<div class="sect3 "  >
    
<h5 id="_new_customers_without_orders">New Customers without Orders</h5>



<div class="paragraph">
<p>If we turn the question around and ask what have I bought, the JOIN stays the same, only the filter changes.
Except if we have customers without any orders and still want to return them.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.ProductName, sum(od.UnitPrice * od.Quantity) as Volume
FROM customers AS c
LEFT OUTER JOIN orders AS o ON (c.CustomerID = o.CustomerID)
LEFT OUTER JOIN order_details AS od ON (o.OrderID = od.OrderID)
LEFT OUTER JOIN products as p ON (od.ProductID = p.ProductID)
WHERE c.CompanyName = 'Drachenblut Delikatessen'
GROUP BY p.ProductName
ORDER BY Volume DESC;</code></pre>
</div>
</div>


<div class="paragraph">
<p>In our Cypher query, the MATCH between customer and order becomes an OPTIONAL MATCH, which is the equivalent of an OUTER JOIN.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (c:Customer {companyName:"Drachenblut Delikatessen"})
OPTIONAL MATCH (p:Product)&lt;-[pu:PRODUCT]-(:Order)&lt;-[:PURCHASED]-(c)
RETURN p.productName, toInt(sum(pu.unitPrice * pu.quantity)) as volume
ORDER BY volume DESC;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_aggregation_top_sellers">Aggregation, Top-Sellers</h4>



<div class="paragraph">
<p>In the previous query we already sneaked in a bit of aggregation.
By summing up product prices and ordered quantities, we provided an aggregated view per product for this customer.</p>
</div>



<div class="paragraph">
<p>You can use aggregation functions like <code>sum, count, avg, max</code> both in SQL and Cypher.
In SQL aggregation is explicit so you have to provide all grouping keys in the <code>GROUP BY</code> clause.
If we want to see our top-selling employees.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT e.EmployeeID, count(*) as Count
FROM Employee as e
JOIN Order AS o ON (o.EmployeeID = e.EmployeeID)
GROUP BY e.EmployeeID
ORDER BY Count DESC LIMIT 10
;</code></pre>
</div>
</div>


<div class="paragraph">
<p>In Cypher grouping for aggregation is implicit.
As soon as you use the first aggregation function, all non-aggregated columns automatically become grouping keys.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (:Order)&lt;-[:SOLD]-(e:Employee)
RETURN e.name, count(*) as cnt
ORDER BY cnt DESC LIMIT 10</code></pre>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_collecting_master_detail_queries">Collecting Master-Detail Queries</h4>



<div class="paragraph">
<p>In SQL there is one dreaded kind of query - master detail information.
You have one main entity (master, head, parent) and many dependent ones (detail, position, child).
Usually you either query it by joining both and returning the master data multiple times (once for each detail), or by only fetching the primary key of the master and then pulling all detail rows via that foreign key.</p>
</div>



<div class="paragraph">
<p>For instance if we look at the employees per territory, then the territory information is returned for each employee.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT e.LastName, et.Description
FROM Employee as e
JOIN EmployeeTerritory AS et ON (et.EmployeeID = e.EmployeeID)
JOIN Territory AS t ON (et.TerritoryID = t.TerritoryID)
;</code></pre>
</div>
</div>


<div class="paragraph">
<p>In Cypher we can return the structure as in SQL.
Or we can choose to use the <code>collect</code> aggregation function, which aggregates values into a collection (list,array).
So we only return one row per parent, containing an inlined collection of child values.
This also works for nested values.</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (t:Territory)&lt;-[:IN_TERRITORY]-(e:Employee)
RETURN t.description, collect(e.lastName);</code></pre>
</div>
</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_hierarchies_and_trees_variable_length_paths">Hierarchies and Trees - Variable Length Paths</h4>



<div class="paragraph">
<p>If you have to express category-, territory- or organizational hierarchies in SQL then you model it usually with a self-join via a foreign key from child to parent.
Adding data is not problematic, as are single level queries (get all children for this parent).
As soon as you get into multi-level queries, the number of joins explodes, especially if your level depth is variable.</p>
</div>



<div class="paragraph">
<p>Taking the example of the product categories, we have to decide upfront up to how many levels of categories we want to query.
We will tackle only three potential levels here (which means 1+2+3 = 6 self-joins of the ProductCategory table).</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="plsql"><code>SELECT p.ProductName
FROM Product as p
JOIN ProductCategory pc ON (p.CategoryID = pc.CategoryID AND pc.CategoryName = "Dairy Products")

JOIN ProductCategory pc1 ON (p.CategoryID = pc1.CategoryID
JOIN ProductCategory pc2 ON (pc2.ParentID = pc2.CategoryID AND pc2.CategoryName = "Dairy Products")

JOIN ProductCategory pc3 ON (p.CategoryID = pc3.CategoryID
JOIN ProductCategory pc4 ON (pc3.ParentID = pc4.CategoryID)
JOIN ProductCategory pc5 ON (pc4.ParentID = pc5.CategoryID AND pc5.CategoryName = "Dairy Products")
;</code></pre>
</div>
</div>


<div class="paragraph">
<p>Cypher is able to express single or fixed level hierarchies just with the appropriate relationships.
Variable levels are represented by variable length paths, which are denoted by a star after the relationship-type and optional limits (min..max).</p>
</div>

<div class="listingblock">
<div class="content code-panel" style="width: 100%; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code programlisting cm-s-neo" data-lang="cypher"><code>MATCH (p:Product)-[:CATEGORY]-&gt;(l:ProductCategory)-[:PARENT*0..]-(:ProductCategory {name:"Dairy Products"})
RETURN p.name</code></pre>
</div>
</div>


<div class="paragraph">
<p>MATCH (choc:Product {ProductName:'Chocolade'})&#8592;[:PRODUCT]-(:Order)&#8592;[:SOLD]-(employee),
      (employee)-[:SOLD]&#8594;()-[:PRODUCT]&#8594;(other:Product)
RETURN employee.EmployeeID, other.ProductName, count(*) as count
ORDER BY count DESC
LIMIT 5</p>
</div>



<div class="paragraph">
<p>also introduce order by, limit</p>
</div>

<div class="sect3 "  >
    
<h5 id="_find_all_products_in_category_x">Find all Products in Category X</h5>



<div class="paragraph">
<p>discuss graph patterns with relationships</p>
</div>

</div>
<div class="sect3 "  >
    
<h5 id="_hierarchy">Hierarchy</h5>


</div>
<div class="sect3 "  >
    
<h5 id="_varlength_path">Varlength path</h5>


</div>
<div class="sect3 "  >
    
<h5 id="_with">With</h5>


</div>
</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_create_a_new_product">Create a new product</h4>


</div>
<div class="sect2 columns medium-12" style='padding-left: 0;' >
    
<h4 id="_create_an_order">create an order</h4>


</div>
                           </div>
                        </div>
                     </section>
                  </div>
               </article>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               </article>
               <div class="calloutsection">
                  <div class="row">
                     <div class="medium-8 small-centered columns text-center">
                        <h3>Stay Connected</h3>
                        <p>Sign up to find out more about Neo4j's upcoming events &amp; meetups.</p>
                     </div>
                  </div>
                  <div class="row">
                     <div class="medium-6 small-centered columns">
                        <div class="row collapse">
                           <div class="small-8 columns">
                              <script src="//app-sjl.marketo.com/js/forms2/js/forms2.js"></script>
                              <form id="mktoForm_519"></form>
                              <script>MktoForms2.loadForm("//app-sjl.marketo.com", "773-GON-065", 519);</script>
                           </div>
                           <div class="small-4 columns"> <a href="#" id="signupbody" class="button postfix">Keep Me Connected &rsaquo;</a> </div>
                        </div>
                     </div>
                  </div>
               </div>
               <style> .mktoButtonWrap {display:none;} </style>
               <script>
                  var btn = document.getElementById("signupbody");
                  btn.onclick = function(){
                  MktoForms2.getForm(519).submit();
                  };
               </script>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               <footer id="footer">
                  <div class="row">
                     <div class="small-6 medium-3 columns">
                        <h5>Learn & Try</h5>
                        <ul>
                           <li><a href="../about-neo4j">About Neo4j</a></li>
                           <li><a href="../graph-concepts/">Graph Concepts</a></li>
                           <li><a href="http://neo4j.com/use-cases/">Use Cases</a></li>
                           <li><a href="http://neo4j.com/customers/">Our Customers</a></li>
                           <li><a href="http://neo4j.com/download/">Download Neo4j</a></li>
                           <li><a href="http://console.neo4j.org/">Live Neo4j Console</a></li>
                           <li><a href="working-with-data/guide-neo4j-browser/">Neo4j Browser</a></li>
                           <li><a href="http://gist.neo4j.org">Graph Gists</a></li>
                        </ul>
                     </div>
                     <div class="small-6 medium-3 columns">
                        <h5>Develop</h5>
                        <ul>
                           <li><a href="http://neo4j.com/docs/">Docs</a></li>
                           <li><a href="../">Neo4j Guides</a></li>
                           <li><a href="working-with-data/guide-importing-data-and-etl">Import Data</a></li>
                           <li><a href="http://neo4j.com/contrib/">Select a Driver</a></li>
                           <li><a href="cypher-query-language/guide-cypher-basics">Cypher Query Language</a></li>
                           <li><a href="build-a-graph-data-model/guide-intro-to-graph-modeling">Data Modeling</a></li>
                        </ul>
                     </div>
                     <div class="small-6 medium-3 columns">
                        <h5>Connect with Neo4j</h5>
                        <ul>
                           <li><a href="http://neo4j.com/training/">Training</a></li>
                           <li><a href="http://neo4j.com/events/">Events</a></li>
                           <li><a href="http://neo4j.com/blog/">Blog</a></li>
                           <li><a href="http://neo4j.com/community/#support">Support</a></li>
                           <li><a href="http://neo4j.com/neo4j-partner-program/">Neo4j Partner Program</a></li>
                           <li><a href="http://neotechnology.com/about/">About Neo Technology</a></li>
                        </ul>
                     </div>
                     <div class="small-12 medium-3 columns">
                        <h5><a href="http://neo4j.com/contact-us">Contact Us &rarr;</a></h5>
                        <p>1-855-636-4532 <a href="mailto:info@neotechnology.com">US <i class="fi-mail"></i></a><br/> +44 808 189 0493 <a href="mailto:uk@neotechnology.com">UK <i class="fi-mail"></i></a><br/> +49 800 723 6231 <a href="mailto:vertrieb@neotechnology.com">Germany <i class="fi-mail"></i></a><br/> +33 (0)8 05 08 03 44 <a href="mailto:ventes@neotechnology.com">France <i class="fi-mail"></i></a></p>
                        <h5>Get Neo4j News</h5>
                        <p>Keep up with the latest graph database trends, tips &amp; events.</p>
                        <div class="row collapse">
                           <div class="small-9 columns">
                              <script src="//app-sjl.marketo.com/js/forms2/js/forms2.js"></script>
                              <form id="mktoForm_477"></form>
                              <script>MktoForms2.loadForm("//app-sjl.marketo.com", "773-GON-065", 477);</script>
                           </div>
                           <div class="small-3 columns"> <a href="#" id="signup" class="button postfix">Go &rsaquo;</a> </div>
                        </div>
                     </div>
                  </div>
               </footer>
               <style> #mktoForm_477 button {display:none;} #mktoForm_477 {margin-left:-20px;} </style>
               <script>
                  var btn = document.getElementById("signup");
                  btn.onclick = function(){
                    MktoForms2.getForm(477).submit();
                  };
               </script>
               <div class="row text-center hide-for-small hr-style">
                  <div class="medium-5 columns">
                     <hr>
                  </div>
                  <div class="medium-2 columns"> <object height="100%" width="100%" data="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/images/hr-image.svg" type="image/svg+xml"></object> </div>
                  <div class="medium-5 columns">
                     <hr>
                  </div>
               </div>
               <div class="row text-center show-for-small">
                  <div class="medium-12 columns">
                     <hr>
                  </div>
               </div>
               <div class="row collapse copyright">
                  <div class="small-12 medium-3 columns text-center">
                     <p>&copy; 2014 <a href="http://neotechnology.com/">Neo Technology, Inc.</a></p>
                  </div>
                  <div class="small-12 medium-6 columns text-center">
                     <code>&#40;graphs&#41;-&#91;&#58;ARE&#93;-&rsaquo;&#40;everywhere&#41;</code>
                     <p>With &hearts; from Sweden &amp; the <a href="http://neo4j.com/community/">Neo4j</a> Community</p>
                  </div>
                  <div class="small-12 medium-3 columns text-center">
                     <ul>
                        <li><a href="http://neo4j.com/terms">Terms</a></li>
                        <li><a href="http://neo4j.com/privacy-policy/">Privacy Policy</a></li>
                     </ul>
                  </div>
               </div>
               <a class="exit-off-canvas"></a>
            </div>
         </div>
         <script src="http://munchkin.marketo.net/munchkin.js" type="text/javascript"></script> <script type="text/javascript">mktoMunchkin("773-GON-065");</script> <script type='text/javascript' src='http://neo4j.com/wp-content/plugins/akismet/_inc/form.js?ver=3.0.1'></script> <script type='text/javascript' src='http://neo4j.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script> <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.2/d3.min.js?ver=3.9.2'></script> <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/json3/3.3.0/json3.min.js?ver=3.9.2'></script> <script type='text/javascript' src='http://neo4j.com/wp-content/themes/neo4jzurb/assets/js/neo_d3.js?ver=3.9.2'></script> <script type='text/javascript' src='http://neo4j.com/wp-includes/js/comment-reply.min.js?ver=3.9.2'></script> <script>
            jQuery(document).foundation({
              tab: {
                callback : function (tab) {
                  $(window).trigger('resize');
                }
              }
            });
         </script> <script src="http://www.neo4j.com/wp-content/themes/neo4jzurb/assets/js/foundation/foundation.equalizer.js"></script>
      </body>
      <script type="text/javascript" src="http://munchkin.marketo.net/munchkin.js"></script> <script type="text/javascript">
         mktoMunchkin("773-GON-065");
      </script>
   </html>